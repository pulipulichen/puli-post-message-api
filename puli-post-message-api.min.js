function PuliPostMessageAPI(h){let y=location.href.slice(location.href.lastIndexOf("/")+1);h=h?h:{};h="boolean"===typeof h.manuallyReady?h.manuallyReady:!1;let q;window.opener?q=window.opener:window.parent&&window.parent!==window&&(q=window.parent);let z=function(a){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(a,1):document.addEventListener("DOMContentLoaded",a)};q&&!1===h&&z(function(){v()});let v=function(){if(!0===w)return!1;w=!0;q&&q.postMessage({eventName:"ready",
url:location.href},"*")},w=!1,r={},u={},f={},e={},A=function(a){!1===Array.isArray(f[a])&&(f[a]=[]);return new Promise(function(b,c){f[a].push(function(){b(!0)});if(1===f[a].length)f[a][0]()})},x=function(a){f[a].shift();0<f[a].length&&setTimeout(function(){f[a][0]()},0)},B=function(a,b,c){b="number"===typeof b?b:.8;c="string"===typeof c?c:"_blank";var d=screen.availWidth*b,p=screen.availHeight*b;d=300>d?300:d;p=300>p?300:p;var e=navigator.userAgent,k=function(){return/\b(iPhone|iP[ao]d)/.test(e)||
/\b(iP[ao]d)/.test(e)||/Android/i.test(e)||/Mobile/i.test(e)},l="undefined"!==typeof window.screenX?window.screenX:window.screenLeft;b="undefined"!==typeof window.screenY?window.screenY:window.screenTop;var f="undefined"!==typeof window.outerWidth?window.outerWidth:document.documentElement.clientWidth,g="undefined"!==typeof window.outerHeight?window.outerHeight:document.documentElement.clientHeight-22;d=k()?null:d;p=k()?null:p;l=parseInt((0>l?window.screen.width+l:l)+(f-d)/2,10);b=parseInt(b+(g-p)/
2.5,10);g=[];null!==d&&g.push("width="+d);null!==p&&g.push("height="+p);g.push("left="+l);g.push("top="+b);c=window.open("",c,g.join(","));c.document.write(`<script>window.moveTo(${l}, ${b});window.resizeTo(${d}, ${p})</script>`);c.document.write(`<script>location.href="${a}"</script>`);window.focus&&c.focus();return c},E=async function(a,b,c,d){await C(b);a().postMessage({eventName:"send",eventType:c,data:d,url:location.href},b);return new Promise(function(a,c){D(b,function(b){a(b)})})},n={},D=function(a,
b){n[a]||(n[a]=[]);-1===n[a].indexOf(b)&&n[a].push(b)},F=function(a,b){if(!1===Array.isArray(n[a]))return!1;n[a].forEach(function(a){if("function"!==typeof a)return!1;a(b)});n[a]=[];x(a);return!0},G=async function(a,b,c,d){if("function"===typeof t[c])c=await t[c](d);else return a.postMessage({eventName:"error",message:"sender's eventType is not found: "+c,url:location.href},b),!1;a.postMessage({eventName:"return",data:c,url:location.href},b)},C=function(a){return!0===r[a]?!0:new Promise(function(b,
c){u[a]=function(){b(!0)}})};window.addEventListener("message",function(a){if("object"!==typeof a.data||!a.data.eventName)return!1;let b=a.data.eventName,c=a.data.data,d=a.data.url,e=a.data.eventType,f=a.source;"return"===b?F(d,c):"send"===b?G(f,d,e,c):"ready"===b?(r[d]=!0,"function"===typeof u[d]&&(u[d](),delete u[d])):"error"===b&&(console.error(a.data.message,y),n[d]=[],x(d))},!0);let t={};return{send:async function(a,b,c){a=(new URL(a,document.baseURI)).href;await A(a);c=c?c:{};let {eventType:d,
callback:f,newWindow:n}=c;d=d?d:"_default";let k="iframe";c&&c.mode&&(k=c.mode);let l=!1;c&&(!0===c.autoClose?l=c.autoClose:"undefined"===typeof c.autoClose&&"popup"===c.mode&&(l=!1));if("popup"===k&&!0===n&&e[a])delete r[a],delete e[a];else if(!0===l&&e[a]){if("iframe"===k){var h=document.querySelector(`iframe[data-url="${a}"]`);null!==h&&h.parentNode.removeChild(h)}else"popup"===k&&e[a].close();delete r[a];delete e[a]}let g,m;if(e[a])g=e[a];else if("iframe"===k)m=document.querySelector(`iframe[data-url="${a}"]`),
null===m&&(m=document.createElement("iframe"),m.style.display="none",m.src=a,m.setAttribute("data-url",a),document.body.appendChild(m));else if("popup"===k){h=void 0;c&&c.target&&(h=c.target);let b=void 0;c&&c.features&&(b=c.features);g="number"===typeof b&&1>=b?B(a,b):window.open(a,h,b)}b=await E(function(){g||"iframe"!==k||(g=m.contentWindow);return g},a,d,b);!0===l?("iframe"===k?m&&m.parentNode.removeChild(m):g.close(),delete r[a],delete e[a]):e[a]||(e[a]=g);"function"===typeof f&&f(b);return b},
addReceiveListener:function(a,b){if("function"===typeof a&&!b)b=a,a="_default";else if("function"!==typeof b)return!1;t[a]=b},removeReceiveListener:function(a,b){"function"!==typeof a||b||(b=a,a="_default");if("function"!==typeof b||!t[a])return!1;delete t[a]},ready:function(){v()}}};
function PuliPostMessageAPI(){let k;window.opener?k=window.opener:window.parent&&window.parent!==window&&(k=window.parent);let q=function(a){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(a,1):document.addEventListener("DOMContentLoaded",a)};k&&q(function(){k.postMessage({eventName:"ready",url:location.href},"*")});let n={},l={},m={},u=async function(a,c,b){await r(c);a().postMessage({eventName:"send",data:b,url:location.href},c);return new Promise(function(a,b){t(c,
function(b){a(b)})})},e={},t=function(a,c){e[a]||(e[a]=[]);-1===e[a].indexOf(c)&&e[a].push(c)},v=function(a,c){if(!1===Array.isArray(e[a]))return!1;e[a].forEach(function(a){if("function"!==typeof a)return!1;a(c)});e[a]=[];return!0},w=async function(a,c,b){let d;"function"===typeof p&&(d=await p(b));a.postMessage({eventName:"return",data:d,url:location.href},c)},r=function(a){return!0===n[a]?!0:new Promise(function(c,b){l[a]=function(){c(!0)}})};window.addEventListener("message",function(a){if("object"!==
typeof a.data||!a.data.eventName)return!1;let c=a.data.eventName,b=a.data.data,d=a.data.url;a=a.source;"return"===c?v(d,b):"send"===c?w(a,d,b):"ready"===c&&(n[d]=!0,"function"===typeof l[d]&&(l[d](),delete l[d]))},!0);let p;return{send:async function(a,c,b,d){a=(new URL(a,document.baseURI)).href;"function"!==typeof b||d||(d=b,b=void 0);let e="iframe";b&&b.mode&&(e=b.mode);let f,g;if(m[a])f=m[a];else if("iframe"===e)g=document.createElement("iframe"),g.style.display="none",g.src=a,document.body.appendChild(g);
else if("popup"===e){var h=void 0;b&&b.target&&(h=b.target);let c=void 0;b&&b.features&&(c=b.features);f=window.open(a,h,c)}h=!0;b&&(!1===b.autoClose?h=b.autoClose:"popup"===b.mode&&(h=!1));c=await u(function(){f||"iframe"!==e||(f=g.contentWindow);return f},a,c);!1===h&&(m[a]||(m[a]=f));!0===h&&("iframe"===e?g.parentNode.removeChild(g):f.close(),delete n[a]);"function"===typeof d&&d(c);return c},onReceive:function(a){if("function"!==typeof a)return!1;p=a}}};